%{
business.BackstageSet  currBackstageSet = business.BackstageSet.getCurrentBackstageSet();
boolean ipsEnable = constants.Constants.IPS_ENABLE;
}%
#{extends 'common/frontMain.html' /}
#{set title:currBackstageSet.seoTitle +' | 我的账户 | 我的账户首页' /}

<div class="p-main clr mt30">
    <link rel="stylesheet" href="@{'/public/jiyuan/Web/Home/View/Public/Css/common.css'}">
    <link rel="stylesheet" href="@{'/public/jiyuan/Web/Home/View/Public/Css/new_common.css'}"> <!-- 改版新浪css-->
    <script type="text/javascript" src="@{'/public/javascripts/add/jsAddress.js'}"></script>

    <!-- 左边导航区域 -->
    #{include "front/account/AccountHome/homeLeft.html"/}
    <div class="p-cfright">
        <div class="step_wrap clearfix">
            <div class="step_title clearfix">
                <h1 class="xf">绑定银行卡 ( 只限绑定一张,不支持信用卡 )</h1>
                <div class="xr"><img src="@{'/public/jiyuan/Web/Home/View/User/Images/sina_icon2.gif'}"/></div>
            </div>

            <div class="step_bord">
                <!--新用户 start-->
                <div class="Validform" id="f2">
                    <table class="form_tb">
                        <tbody>
                        <tr>
                            <th width="30%">真实姓名</th>
                            <td width="70%">${user?.realityName}	</td>
                        </tr>
                        <tr>
                            <th><span class="red">* </span>选择银行</th>
                            <td>
                                <div class="clearfix">
                                    <select id="banklist" name="banklist" onchange="changebranches()" class="ui_select xf" style="width:275px;">
                                        <option value="ICBC">工商银行</option><option value="CCB">建设银行</option><option value="COMM">交通银行</option><option value="ABC">农业银行</option><option value="PSBC">中国邮储银行</option><option value="BOC">中国银行</option><option value="CMB">招商银行</option><option value="SPDB">浦东发展银行</option><option value="CMBC">民生银行</option><option value="CEB">光大银行</option><option value="CIB">兴业银行</option><option value="CITIC">中信银行</option><option value="HXB">华夏银行</option><option value="GDB">广东发展银行</option><option value="SZPAB">平安银行</option><option value="BOS">上海银行</option>										</select>
                                    <div class="xf money1"><a href="./?c=SpecialPage&a=rechargeQuickLimitList" target="_blank">查看快捷充值限额</a></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><span class="red">* </span>储蓄卡卡号</th>
                            <td>
                                <input class="ui_input" id="account" name="account" type="text" placeholder="请输入您的储蓄卡卡号" datatype="n16-19"  sucmsg=" " errormsg="请输入16-19位卡号" nullmsg="请填写内容" />
                            </td>
                        </tr>
                        <tr>
                            <th><span class="red">* </span>确认卡号</th>
                            <td>
                                <input class="ui_input" id="raccount" type="text" placeholder="请再次输入您的储蓄卡卡号" datatype="*"  recheck="account" sucmsg=" " errormsg="两次输入的卡号不一致" nullmsg="请填写内容" />
                            </td>
                        </tr>
                        <tr>
                            <th><span class="red">* </span>开户行省市</th>
                            <td>
                                <!--<select id="prolist2" onchange="changecitys()" class="ui_select" style="width:192px;">
                                    　  <option value="1">安徽省</option>　  <option value="2">北京市</option>　  <option value="3">福建省</option>　  <option value="4">甘肃省</option>　  <option value="5">广东省</option>　  <option value="6">广西自治区</option>　  <option value="7">贵州省</option>　  <option value="8">海南省</option>　  <option value="9">河北省</option>　  <option value="10">河南省</option>　  <option value="11">黑龙江省</option>　  <option value="12">湖北省</option>　  <option value="13">湖南省</option>　  <option value="14">吉林省</option>　  <option value="15">江苏省</option>　  <option value="16">江西省</option>　  <option value="17">辽宁省</option>　  <option value="18">内蒙古自治区</option>　  <option value="19">宁夏自治区</option>　  <option value="20">青海省</option>　  <option value="21">山东省</option>　  <option value="22">山西省</option>　  <option value="23">陕西省</option>　  <option value="24">上海市</option>　  <option value="25">四川省</option>　  <option value="26">天津市</option>　  <option value="27">西藏自治区</option>　  <option value="28">新疆自治区</option>　  <option value="29">云南省</option>　  <option value="30">浙江省</option>　  <option value="31">重庆市</option>									</select>
                                <select  id="citylist2" datatype="s" errormsg="请选择城市" sucmsg=" " onchange="changebranches()" class="ui_select" style="width:192px;">
                                </select>-->
                                <select id="Select1" class="ui_select" style="width:120px;"></select>
                                <select id="Select2" class="ui_select" style="width:120px;"></select>
                                <select id="Select3" class="ui_select" style="width:120px;"></select>
                                <script type="text/javascript">
                                    addressInit('Select1', 'Select2', 'Select3');
                                </script>
                            </td>
                        </tr>
                        <tr>
                            <th><span class="red">* </span>预留手机号码</th>
                            <td>
                                <input class="ui_input" id="phone2" name="phone" value="" type="text" placeholder="请输入您的预留手机号码"  sucmsg=" " errormsg="请输入合法的手机号码" nullmsg="请填写内容" />
                                <input type="hidden" id="province2" name="province"/>
                                <input type="hidden" id="city2" name="city"/>
                                <input type="hidden" id="branche2" name="branche"/>
                            </td>
                        </tr>
                        <tr>
                            <th></th>
                            <td style="padding:0 !important;" class="f12 gray"></td>
                        </tr>

                        <tr>
                            <th></th>
                            <td colspan="2">
                                <input id='submit2' type="button" class="btn_common btn_blue" value="下一步（获取验证码）" onclick="check()" style="width:auto !important;">
                            </td>
                        </tr>

                        </tbody>
                    </table>
                </div>
                <!--新用户 end-->
            </div>

            <div class="help_tip">
                <h1>温馨提示：</h1>
                <ul>
                    <li>1. 使用的卡必须是银联卡，且开通网银支付功能。</li>
                    <li>2. 绑卡需要提供姓名、证件号、银行预留手机号、短信验证码等，与银行开户信息一致。</li>
                    <li>3. 工商银行：①用户必须柜面留存手机，电话留存的手机号码不可以；②用户卡不能是集体卡，单位集体办理的卡一律不能使用；③同一个用户不能有跨省卡，如A有一张北京工行卡，一张上海工行卡，那A的工行卡都不可以使用。</li>
                    <li>4. 浦发银行：需要用户开通"网上银行"和"无卡支付"。</li>
                    <li>5. 光大银行：需要用户开通“网上支付”。</li>
                    <li>6. 邮储银行和上海银行：需要用户开通“银联无卡自助消费业务”。</li>
                    <li>7. 必须使用银行卡进行绑定，纸质存折不能绑定。</li>
                    <li>8. 由于手机运营商原因，暂时无法为176、177号段的客户提供服务！请选择其他号段的手机号绑定。</li>
                    <li>9. 每日的充值限额根据银行为准<a href="./?c=SpecialPage&a=rechargeQuickLimitList" target="_blank">查看快捷充值限额</a>。</li>
                </ul>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript" src="@{'/public/javascripts/tab/tab_usr.js'}"></script>
<script type="text/javascript">
    $(function(){
        /* 高亮显示 */
        //showHighLightFront2(7, 1);
        myAccountSelect(1,110);
    });

</script>
<script type="text/javascript">
    var flag2 = true;
    var chooseBranches = '--请选择开户行支行名称--';
    changecitys();

    /**
     * 联动城市 新银行卡页
     */
    function changecitys() {
        var provinceID = document.getElementById('prolist2').value;
        $.ajax({
            url: " ",
            data: "provinceID=" + provinceID,
            type: "post",
            success: function(result) {
                var html = "<option>--请选择开户城市名称--</option>";
                if (result != '获取城市失败!'){
                    var city_list = eval('(' + result + ')');
                    $(city_list).each(function(k, v) {
                        html += '<option  value="' + v.id + '">' + v.city + '</option>';
                    });
                }else{
                    alert(result);
                }
                $("#citylist2").html(html);
                changebranches();
            },
            error: function(xhr) {
                alert("城市获取失败！");
            }
        });
    }

    /**
     * 联动支行
     */
    function changebranches() {
        var index = document.getElementById("prolist2").selectedIndex;
        var province = document.getElementById('prolist2').options[index].text;
        index = document.getElementById("citylist2").selectedIndex;
        var city = document.getElementById('citylist2').options[index].text;

        //保存到银行文本框中
        document.getElementById("province2").value = province;
        document.getElementById("city2").value = city;
    }

    /**
     * 异步绑定银行卡
     */
    function check(){
        //获取参数
        $("#submit2").blur();
        var branche = '';
        var msg = '';

        if (flag2){
            flag2 = !flag2;
        }else{
            return;
        }

        $("#submit2").removeClass("btn_blue").addClass("btn_gray");
        var account = document.getElementById("account").value;
        var account2 = document.getElementById("raccount").value;
        var bankcode = document.getElementById("banklist").value;
        var province = document.getElementById("province2").value;
        var city = document.getElementById("city2").value;
        var phone = document.getElementById("phone2").value;
        if(account != account2){
            msg = '两次输入的卡号不一致！';
        }

//        if((msg=='') && (province == '' || city == '')){
//            msg = '请输入内容！';
//        }
        if((msg=='') && (bankcode == '')){
            msg = '请选择银行！';
        }
        if((msg=='') && (account == '')){
            msg = '请输入银行卡号！';
        }
        if ((msg=='')){
            var partten = /^1[3,5,8,4,7]\d{9}$/;
            if(!partten.test(phone)){
                msg = '请输入合法的手机号码！';
            }
        }
//        if ((msg=='')){
//            var partten = /^17[6,7]\d{8}$/;
//            if(partten.test(phone)){
//                msg = '由于手机运营商原因,暂时无法为176、177号段的客户提供服务!';
//            }
//        }

        if (msg != ''){
            alert(msg);
            flag2 = !flag2;
            $("#submit2").removeClass("btn_gray").addClass("btn_blue");
            return;
        }

        var param = "bankcode="+bankcode+"&account="+account+"&province="+province+"&city="+city+"&branche="+branche+"&phone="+phone;
        $.ajax({
            url:"",
            data:param,
            type:"post",
            success: function(s){
                if (s == '提交成功！'){
                    window.location.href = 'bindBankCardAdvance.html';
                    return;
                }else{
                    flag2 = !flag2;
                    $("#submit2").removeClass("btn_gray").addClass("btn_blue");
                    alert(s);
                }
            },
            error: function(s){
                flag2 = !flag2;
                $("#submit2").removeClass("btn_gray").addClass("btn_blue");
                alert('绑卡失败，请联系在线客服！');
            }
        });
    }
</script>
