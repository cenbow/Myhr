#{extends 'common/supervisor.html' /}
#{set title:'服务费设置' /}

%{
	boolean debtUse = constants.Constants.DEBT_USE;
}%

<div class="xn_c_contentwarp">
  <div class="xn_c_contentlist">
    #{include "supervisor/systemSettings/common/leftBar.control"/}
    <div class="xn_c_content">
      <div class="xf_content_add">
        <div class="xfht_t_j_y_2">
          <!--右上-->
          <div class="xf_ht_obu_fklm">
                                        平台服务费设置
          </div>
          <div class="xf_htgl_jgone xf_ht_fff_sz">
            <h3 class="xf_htgl_jgtitle">借款管理费</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">借款管理费(月)：借款本金 *
                <input class="xfht_zr_input" type="text" style="width:80px;" id="borrowFee" value="${backstageSet?.borrowFee}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/^\.+/, '').replace(/^(100|\d{1,2}(\.\d{0,2})?).*/,'$1')"> %  +本金*（期数  - 
                <input class="xfht_zr_input" type="text" style="width:80px;" id="borrowFeeMonth" value="${backstageSet?.borrowFeeMonth}" onkeyup="value=value.replace(/[^\d]/g,'').replace(/^(100|\d{0,2})*/g, '$1')">个月）* 
                <input class="xfht_zr_input" type="text" style="width:80px;" id="borrowFeeRate" value="${backstageSet?.borrowFeeRate}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/^\.+/, '').replace(/^(100|\d{1,2}(\.\d{0,2})?).*/,'$1')">  %                
                <br/>借款管理费(日)：借款本金 *
                <input class="xfht_zr_input" type="text" style="width:80px;" id="borrowFeeDay" value="${backstageSet?.borrowFeeDay}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/^\.+/, '').replace(/^(100|\d{1,2}(\.\d{0,2})?).*/,'$1')"> % / ${day_interest} * 借款天数         
                <br/>
                <br/><font color="red" >提示：借款管理费最大为本金的50%，如果超出本金的50%，将按照本金的50%收取</font>
                </td>
              </tr>
              </table>
            </div>
            <h3 class="xf_htgl_jgtitle">理财管理费</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">理财管理费：按年利率收益 
                <input class="xfht_zr_input" type="text" style="width:80px;" id="investmentFee" value="${backstageSet?.investmentFee}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/^\.+/, '').replace(/^(100|\d{1,2}(\.\d{0,2})?).*/,'$1')"> %收取            
                </td>
              </tr>
              </table>
            </div>
            #{if debtUse}
            <h3 class="xf_htgl_jgtitle">债权转让管理费</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">债权转让管理费：按年利率收益 
                <input class="xfht_zr_input" type="text" style="width:80px;" id="debtTransferFee" value="${backstageSet?.debtTransferFee}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/^\.+/, '').replace(/^(100|\d{1,2}(\.\d{0,2})?).*/,'$1')"> %收取           
                </td>
              </tr>
              </table>
            </div>
            #{/if}
            #{else}
            <input  type="hidden" id="debtTransferFee" value="0"> 
            #{/else}
            <h3 class="xf_htgl_jgtitle">逾期管理费</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">逾期罚息：按账单金额 
                <input class="xfht_zr_input" type="text" style="width:80px;" id="overdueFee" value="${backstageSet?.overdueFee}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/^\.+/, '').replace(/^(100|\d{1,2}(\.\d{0,2})?).*/,'$1')"> % * 逾期天数收取       
                </td>
              </tr>
              </table>
            </div>
            <h3 class="xf_htgl_jgtitle">提现手续费</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">提现手续费：按（提现金额  -  
                <input class="xfht_zr_input" type="text" style="width:80px;" id="withdrawFee" value="${backstageSet?.withdrawFee}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/(\.\d{2}).*/g, '$1')">）  * 
                <input class="xfht_zr_input" type="text" style="width:80px;" id="withdrawRate" value="${backstageSet?.withdrawRate}" onkeyup="value=value.replace(/[^\d\.]/g, '').replace(/^\.+/, '').replace(/^(100|\d{1,2}(\.\d{0,2})?).*/,'$1')">% + 
                <input class="xfht_zr_input" type="text" style="width:80px;" id="withdrawBase" oninput="this.value=this.value.replace(/\D/g,'')" value="${backstageSet?.withdrawBase}" /> 收取     
                <br/>
                <br/><font color="red" >提示：提现手续费最大为提现金额的1%，如果超出1%，将按照1%收取</font>
                </td>
              </tr>
              </table>
            </div>
            <h3 class="xf_htgl_jgtitle">资料审核费</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">
                <span class="xfht_gl_span_cen">见审核科目库管理</span>
                </td>
              </tr>
              </table>
            </div>
            
            <h3 class="xf_htgl_jgtitle">最低充值金额</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">
                		最低充值金额：
                <input type="text" class="xfht_zr_input" style="width:100px;margin:0 5px 0 10px" id="rechargeLowest" value="${backstageSet?.rechargeLowest}" onkeyup="value=value.replace(/[^\d]/g, '').replace(/^(10000|\d{0,4}).*/, '$1')">元
                </td>
              </tr>
              </table>
            </div>
            <h3 class="xf_htgl_jgtitle">最高充值金额</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">
                		最高充值金额：
                <input type="text" class="xfht_zr_input" style="width:100px;margin:0 5px 0 10px" id="rechargeHighest" value="${backstageSet?.rechargeHighest}" onkeyup="value=value.replace(/[^\d]/g, '').replace(/^(10000000|\d{0,7}).*/, '$1')">元
                </td>
              </tr>
              </table>
            </div>
            
            <h3 class="xf_htgl_jgtitle">最低提现金额</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">
                		最低提现金额：
                <input type="text" class="xfht_zr_input" style="width:100px;margin:0 5px 0 10px" id="walLowest" value="${backstageSet?.walLowest.format('###,##0')}" onkeyup="rawRange(this)">元
                </td>
              </tr>
              </table>
            </div>
            
            <h3 class="xf_htgl_jgtitle">直接奖励系数</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">
                		直接奖励系数：
                <input type="text" class="xfht_zr_input" style="width:100px;margin:0 5px 0 10px" id="recommendRate" value="${backstageSet?.recommendRate}" >元
                </td>
              </tr>
              </table>
            </div>
            
            <h3 class="xf_htgl_jgtitle">转介绍奖励系数</h3>
            <div class="xf_ht_gl_jgone_botton">
              <table border="0" cellspacing="0" cellpadding="0" width="100%">
              <tr>
                <td align="center">
                		转介绍奖励系数：
                <input type="text" class="xfht_zr_input" style="width:100px;margin:0 5px 0 10px" id="indirectRecommendRate" value="${backstageSet?.indirectRecommendRate}" >元
                </td>
              </tr>
              </table>
            </div>
            
          </div>
          <div class="xf_htgl_jgsix_hyg">
            <input class="xf_ht_tcc_button_ok" type="button" onclick="save()" id="xf_dfk_fkzh_tcc3" value="保存">
          </div>
        </div>
      </div>
    </div>

    
    
  </div>
</div>

<script type="text/javascript">
  	$(function() {
    	/* 高亮显示 */
	  	showHighLight(2,2,5);
  	});

	//正则范围：0.00-99.99,可输入2位小数，8位整数位
	function rawRange(obj){
	  obj.value=obj.value.replace(/[^\d\.]/g,'').replace(/^\.+/,'').replace(/^(\d{1,5}(\.\d{0,2})?).*/,'$1');
	}
  
  	function save() {
	    var borrowFee = $("#borrowFee").val();
	    var borrowFeeDay = $("#borrowFeeDay").val();
	    var borrowFeeMonth = $("#borrowFeeMonth").val();
	    var borrowFeeRate = $("#borrowFeeRate").val();
	    
	    if ("" == borrowFee.trim() || "" == borrowFeeMonth.trim() || "" == borrowFeeRate.trim() || "" == borrowFeeDay.trim()) {
	      alert("请把借款管理费信息填充完整");
	      
	      return;
	    }
	    
	    var investmentFee = $("#investmentFee").val();
	    
	    if ("" == investmentFee.trim()) {
	      alert("请填写理财管理费");
	      
	      return;
	    }
	    
	    var debtTransferFee = $("#debtTransferFee").val();
	    
	    if ("" == investmentFee.trim()) {
	      alert("请填写债权转让管理费");
	      
	      return;
	    }
	    
	    var overdueFee = $("#overdueFee").val();
	    
	    if ("" == investmentFee.trim()) {
	      alert("请填写逾期罚息");
	      
	      return;
	    }
	    
	    var withdrawFee = $("#withdrawFee").val();
	    var withdrawRate = $("#withdrawRate").val();
	    var withdrawBase = $("#withdrawBase").val();
	    
	    var recommendRate = $("#recommendRate").val();
	    var indirectRecommendRate = $("#indirectRecommendRate").val();
	    
	    if ("" == withdrawRate.trim() || "" == withdrawFee.trim()) {
	      alert("请把提现手续费信息填充完整");
	      
	      return;
	    }
	    
	    if (withdrawBase == null || withdrawBase == "" || withdrawBase == undefined){
	    	withdrawBase = 0;
	    }
	    /*不需要充值手续费
	    var rechargeFee = $("#rechargeFee").val();
	    
	    if ("" == rechargeFee.trim()) {
	      alert("请填写充值手续费");
	      
	      return;
	    }
	    */
	   /* var vipTimeType = $(':radio[name="vipTimeType"]:checked').val();*/
	    /*var vipTimeLength;
	    
	    if ("0" == vipTimeType) {
	      vipTimeLength = $("#vipTimeLength0").val();
	    } else {
	      vipTimeLength = $("#vipTimeLength1").val();
	    }*/
	    
	    
	    var rechargeLowest = $.trim($('#rechargeLowest').val());
	    if(rechargeLowest == ''){
	    	alert('最低充值金额不能为空');
	    	return;
	    }
	    if(isNaN(rechargeLowest) || rechargeLowest < 0){
	    	alert('最低充值金额必须大于等于0');
	    	return;
	    }
	    
	    var rechargeHighest = $.trim($('#rechargeHighest').val());
	    if(rechargeHighest == ''){
	    	alert('最高充值金额不能为空');
	    	return;
	    }
	    if(isNaN(rechargeHighest) || rechargeHighest < 0){
	    	alert('最高充值金额必须大于等于0');
	    	return;
	    }
	    
	    if(parseInt(rechargeLowest) >= parseInt(rechargeHighest)){
	    	alert('最高充值金额不能小于最低充值金额');
	    	return;
	    }
	
	    var walLowest = $.trim($('#walLowest').val());
	    if(walLowest == ''){
	    	alert('最低提现金额不能为空');
	    	return;
	    }
	    if(isNaN(walLowest) || walLowest < 0){
	    	alert('最低提现金额必须大于等于0');
	    	return;
	    }
	    if(isNaN(recommendRate) || recommendRate > 1 || recommendRate < 0){
	    	alert('介绍奖励费系数必须为有效的数字且位于0到1之间');
	    	return;
	    }
	    if(isNaN(indirectRecommendRate) || indirectRecommendRate > 1 || indirectRecommendRate < 0){
	    	alert('转介绍奖励费系数必须为有效的数字且位于0到1之间');
	    	return;
	    }
	    
	    $.ajax({
	      url : "@{saveServiceFees()}",
	      type : "POST",
	      data : {
	        "borrowFee" : borrowFee,
	        "borrowFeeDay" : borrowFeeDay,
	        "borrowFeeMonth" : borrowFeeMonth,
	        "borrowFeeRate" : borrowFeeRate,
	        "investmentFee" : investmentFee,
	        "debtTransferFee" : debtTransferFee,
	        "overdueFee" : overdueFee,
	        "withdrawFee" : withdrawFee,
	        "withdrawRate" : withdrawRate,
	        "withdrawBase" : withdrawBase,
	        "rechargeLowest" : rechargeLowest,
	        "rechargeHighest" : rechargeHighest,
	        "walLowest" : walLowest,
	        "recommendRate":recommendRate,
	        "indirectRecommendRate":indirectRecommendRate
	      },
	      success : function(data) {
			var result = checkSupIntercepterResult(data);  //调用supervisor.html的方法
			if(result){
				return;
			}
	        alert(data.msg);
	      },
	      error : function() {
	        alert("对不起，出现错误!");
	      }
	    });
  	}
</script>


